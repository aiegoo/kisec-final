<?xml version="1.0" encoding="UTF-8"?>
<Sysmon schemaversion="4.70">
  <EventFiltering>

    <!-- Event ID 1: ProcessCreate -->
    <ProcessCreate onmatch="include">
      <CommandLine condition="is not null"/>
    </ProcessCreate>

    <!-- Event ID 3: NetworkConnect -->
    <NetworkConnect onmatch="include">
      <DestinationPort condition="is not null"/>
    </NetworkConnect>

    <!-- Event ID 5: ProcessTerminate -->
    <ProcessTerminate onmatch="include">
      <Image condition="is not null"/>
    </ProcessTerminate>

    <!-- Event ID 9: RawAccessRead -->
    <RawAccessRead onmatch="include">
      <Device condition="is not null"/>
    </RawAccessRead>

    <!-- Event ID 10: ProcessAccess -->
    <ProcessAccess onmatch="include">
      <SourceImage condition="is not null"/>
    </ProcessAccess>

    <!-- Event ID 11: FileCreate -->
    <FileCreate onmatch="include">
      <TargetFilename condition="is not null"/>
    </FileCreate>

    <!-- Event ID 15: FileCreateTime -->
    <FileCreateTime onmatch="include">
      <TargetFilename condition="is not null"/>
    </FileCreateTime>

    <!-- Event ID 23: FileDelete -->
    <FileDelete onmatch="include">
      <TargetFilename condition="is not null"/>
    </FileDelete>

    <!-- ImageLoad: Shared Libraries Monitoring -->
    <ImageLoad onmatch="include">
      <ImageLoaded condition="end with">.so</ImageLoaded>
    </ImageLoad>

    <ModuleLoad onmatch="include">
      <ImageLoaded condition="is not null"/>
    </ModuleLoad>

    <!-- Privilege Escalation Monitoring -->
    <SetUID onmatch="include">
      <UserID condition="greater_than">0</UserID>
    </SetUID>

    <!-- Persistence Monitoring (Cron Jobs) -->
    <FileCreate onmatch="include">
      <TargetFilename condition="contains">/etc/cron.</TargetFilename>
      <TargetFilename condition="contains">/var/spool/cron/</TargetFilename>
    </FileCreate>

    <!-- Kernel Module Loads -->
    <KernelModuleLoad onmatch="include">
      <ImageLoaded condition="is not null"/>
    </KernelModuleLoad>

    <!-- Specific Service Directories (Targeted High-Risk Areas) -->
    <FileCreate onmatch="include">
      <TargetFilename condition="contains">/bin/</TargetFilename>
      <TargetFilename condition="contains">/sbin/</TargetFilename>
      <TargetFilename condition="contains">/usr/bin/</TargetFilename>
      <TargetFilename condition="contains">/usr/sbin/</TargetFilename>
      <TargetFilename condition="contains">/etc/ssh/</TargetFilename>
      <TargetFilename condition="contains">/etc/samba/</TargetFilename>
      <TargetFilename condition="contains">/var/www/</TargetFilename>
      <TargetFilename condition="contains">/lib/</TargetFilename>
      <TargetFilename condition="contains">/var/log/</TargetFilename>
    </FileCreate>

  </EventFiltering>
</Sysmon>
